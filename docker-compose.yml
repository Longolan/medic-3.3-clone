version: '3.3'

services:

  nginx:
    container_name: web_server
    hostname: webserver
    image: nginx:alpine
    ports:
      - "7007:80"
    environment:
      - NGINX_PORT=80
    networks:
      - medic-net
    depends_on:
      - couchdb
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/medic.lg-apps.com:/etc/nginx/sites-enabled/default.lg-apps.com

  webapp:
    build: .
    container_name: medic
    hostname: medic
    ports:
      - "127.0.0.1:5988:5988"
    networks:
      - medic-net
    volumes:
      - .:/srv/
      - ./api/logs/:/srv/api/logs/
      - ./sentinel/logs:/srv/sentinel/logs/
    depends_on:
      - couchdb
      - nginx
    env_file:
      - ./.env
      - ./.couch

  couchdb:
      container_name: couchdb
      hostname: couch
      image: 'couchdb:2.2'
      networks:
        - medic-net
      ports:
        - "127.0.0.1:5984:5984"
        - "127.0.0.1:4370:4369"
        - "127.0.0.1:9101:9100"
      env_file:
        - ./.couch
      volumes:
        - couchdb-data:/opt/couchdb/data
        - ./local.ini:/opt/couchdb/etc/local.ini

volumes:
  couchdb-data:

networks:
  medic-net:
    labels:
      com.medic-net.description: "docker containers compose internal network"
